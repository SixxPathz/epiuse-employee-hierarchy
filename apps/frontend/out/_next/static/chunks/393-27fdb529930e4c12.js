(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[393],{2637:function(e,a,s){"use strict";s.d(a,{Z:function(){return g}});var t=s(5893),n=s(7294),r=s(1664),i=s.n(r),l=s(1163),c=s(9037),o=s(5892),d=s(2044),m=s(3950),u=s(3252),x=s(1594),h=s(4981),f=s(3854),p=s(2121),y=s(7489),v=s(2967);function g(e){var a,s,r,g;let{children:N,user:w}=e,[j,b]=(0,n.useState)(!1),[E,S]=(0,n.useState)(w||null),P=(0,l.useRouter)(),q=(0,v.aU)();if(null===w)return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row min-h-screen",children:[(0,t.jsx)("div",{className:"lg:w-64 bg-white shadow-sm border-r border-gray-200",children:(0,t.jsx)("div",{className:"h-16 flex items-center px-4 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"animate-pulse flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"h-8 w-8 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-6 w-24 bg-gray-200 rounded"})]})})}),(0,t.jsx)("main",{className:"flex-1 p-6",children:N})]})});if(void 0===w)return(0,t.jsxs)("div",{className:"h-screen flex overflow-hidden bg-gray-50",children:[(0,t.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,t.jsx)("div",{className:"flex flex-col w-64",children:(0,t.jsx)("div",{className:"sidebar h-0 flex-1",children:(0,t.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,t.jsx)("div",{className:"flex items-center flex-shrink-0 px-4 mb-6",children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)("img",{src:"/logo.png",alt:"EPI-USE Logo",className:"h-10 w-auto mr-1"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-epi-navy",children:"Nexus"})]}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("h1",{className:"text-sm font-semibold text-epi-navy",children:"EPI-USE Employee Portal"})})]})}),(0,t.jsx)("nav",{className:"px-2 space-y-1",children:(0,t.jsx)("div",{className:"animate-pulse space-y-2",children:[1,2,3,4].map(e=>(0,t.jsx)("div",{className:"h-10 bg-gray-200 rounded"},e))})})]})})})}),(0,t.jsxs)("div",{className:"flex flex-col w-0 flex-1 overflow-hidden",children:[(0,t.jsxs)("div",{className:"header",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("div",{className:"animate-pulse h-6 bg-gray-200 rounded w-32"})}),(0,t.jsxs)("div",{className:"ml-4 flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"animate-pulse flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"h-8 w-8 bg-gray-200 rounded-full"}),(0,t.jsxs)("div",{className:"hidden md:block space-y-1",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-24"}),(0,t.jsx)("div",{className:"h-3 bg-gray-200 rounded w-16"})]})]}),(0,t.jsx)("div",{className:"animate-pulse h-8 bg-gray-200 rounded w-20"})]})]}),(0,t.jsx)("main",{className:"main-content",children:N})]})]});if((0,n.useEffect)(()=>{let e=e=>{S(e.detail)};window.addEventListener("userProfileUpdated",e);let a=()=>{let e=localStorage.getItem("user");if(e)try{let a=JSON.parse(e);S(a)}catch(e){console.error("Error parsing updated user data:",e)}};return window.addEventListener("storage",a),()=>{window.removeEventListener("userProfileUpdated",e),window.removeEventListener("storage",a)}},[]),(0,n.useEffect)(()=>{w&&S(w)},[w]),!E)return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-company-navy"})});let k=(0,p.$)(E.role||"EMPLOYEE"),D=[{name:"Dashboard",href:"/dashboard",icon:c.Z,requiredPermission:null},{name:"ADMIN"===E.role?"Employees":"TeamSpace",href:"/employees",icon:o.Z,requiredPermission:"canViewEmployees"},{name:"Organization Chart",href:"/org-chart",icon:d.Z,requiredPermission:"canViewEmployees"},{name:"Profile",href:"/profile",icon:m.Z,requiredPermission:null},{name:"Settings",href:"/settings",icon:u.Z,requiredPermission:null,roles:["ADMIN"]}].filter(e=>(!e.roles||!!e.roles.includes(E.role))&&(!e.requiredPermission||k[e.requiredPermission]));return(0,t.jsxs)("div",{className:"h-screen flex overflow-hidden bg-gray-50",children:[j&&(0,t.jsxs)("div",{className:"fixed inset-0 z-40 lg:hidden",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>b(!1)}),(0,t.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,t.jsx)("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:(0,t.jsx)("button",{type:"button",className:"ml-1 flex items-center justify-center h-10 w-10 rounded-full focus:outline-none",onClick:()=>b(!1),children:(0,t.jsx)(x.Z,{className:"h-6 w-6 text-white"})})}),(0,t.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,t.jsx)("div",{className:"flex-shrink-0 flex items-center px-4 mb-6",children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)("img",{src:"/logo.png",alt:"EPI-USE Logo",className:"h-10 w-auto mr-1"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-epi-navy",children:"Nexus"})]}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("h1",{className:"text-sm font-semibold text-epi-navy",children:"EPI-USE Employee Portal"})})]})}),(0,t.jsx)("nav",{className:"px-2 space-y-1",children:D.map(e=>{let a=P.pathname===e.href;return(0,t.jsxs)(i(),{href:e.href,className:"nav-link ".concat(a?"nav-link-active":"nav-link-inactive"),onClick:()=>b(!1),children:[(0,t.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})})]})]})]}),(0,t.jsx)("div",{className:"hidden lg:flex lg:flex-shrink-0",children:(0,t.jsx)("div",{className:"flex flex-col w-64",children:(0,t.jsx)("div",{className:"sidebar h-0 flex-1",children:(0,t.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,t.jsx)("div",{className:"flex items-center flex-shrink-0 px-4 mb-6",children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)("img",{src:"/logo.png",alt:"EPI-USE Logo",className:"h-10 w-auto mr-1"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-epi-navy",children:"Nexus"})]}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("h1",{className:"text-sm font-semibold text-epi-navy",children:"EPI-USE Employee Portal"})})]})}),(0,t.jsx)("nav",{className:"px-2 space-y-1",children:D.map(e=>{let a=P.pathname===e.href;return(0,t.jsxs)(i(),{href:e.href,className:"nav-link ".concat(a?"nav-link-active":"nav-link-inactive"),children:[(0,t.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})})]})})})}),(0,t.jsxs)("div",{className:"flex flex-col w-0 flex-1 overflow-hidden",children:[(0,t.jsx)("div",{className:"lg:hidden",children:(0,t.jsxs)("div",{className:"flex items-center justify-between bg-white border-b border-gray-200 px-4 py-3",children:[(0,t.jsx)("button",{type:"button",className:"text-gray-500 hover:text-gray-900 focus:outline-none",onClick:()=>b(!0),children:(0,t.jsx)(h.Z,{className:"h-6 w-6"})}),(0,t.jsx)("h1",{className:"text-lg font-semibold text-epi-navy",children:"EPI-USE Nexus"}),(0,t.jsx)("div",{className:"w-6"})]})}),(0,t.jsxs)("div",{className:"header",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:(null===(a=D.find(e=>e.href===P.pathname))||void 0===a?void 0:a.name)||"Dashboard"})}),(0,t.jsxs)("div",{className:"ml-4 flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)(y.Z,{user:E,size:32,className:"h-8 w-8 rounded-full object-cover",alt:"User avatar"}),(0,t.jsxs)("div",{className:"hidden md:block",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null===(s=E.employee)||void 0===s?void 0:s.firstName)&&(null===(r=E.employee)||void 0===r?void 0:r.lastName)?"".concat(E.employee.firstName," ").concat(E.employee.lastName):E.email}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:E.role}),(null===(g=E.employee)||void 0===g?void 0:g.position)&&(0,t.jsxs)("span",{className:"text-xs text-gray-400",children:["â€¢ ",E.employee.position]})]})]})]}),(0,t.jsxs)("button",{onClick:()=>{q()},className:"btn-outline text-xs flex items-center",children:[(0,t.jsx)(f.Z,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]}),(0,t.jsx)("main",{className:"main-content",children:N})]})]})}},7489:function(e,a,s){"use strict";s.d(a,{Z:function(){return i}});var t=s(5893),n=s(7294),r=s(9844);function i(e){let{user:a,size:s=40,className:i="rounded-full object-cover",alt:l="Profile picture"}=e,[c,o]=(0,n.useState)(!1),[d,m]=(0,n.useState)(!0),[u,x]=(0,n.useState)(a);if((0,n.useEffect)(()=>{let e=e=>{x(e.detail),o(!1),m(!0)};return window.addEventListener("userProfileUpdated",e),()=>{window.removeEventListener("userProfileUpdated",e)}},[]),(0,n.useEffect)(()=>{var e,s;u&&u.email===(null==a?void 0:a.email)&&(null===(e=u.employee)||void 0===e?void 0:e.profilePicture)===(null==a?void 0:null===(s=a.employee)||void 0===s?void 0:s.profilePicture)||(x(a),o(!1),m(!0))},[a,u]),!u||!u.email)return(0,t.jsx)("div",{className:"bg-gray-300 animate-pulse ".concat(i),style:{width:"".concat(s,"px"),height:"".concat(s,"px")}});let h=(0,r._r)(u.employee,u.email,s),f=(0,r.bB)(u.email,s);return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:c?f:h,alt:l,className:i,onError:()=>{c||o(!0),m(!1)},onLoad:()=>{m(!1)},style:{width:"".concat(s,"px"),height:"".concat(s,"px"),display:d?"none":"block"}}),d&&(0,t.jsx)("div",{className:"bg-gray-200 animate-pulse ".concat(i),style:{width:"".concat(s,"px"),height:"".concat(s,"px")}})]})}},2967:function(e,a,s){"use strict";s.d(a,{$I:function(){return o},A4:function(){return p},QH:function(){return d},UE:function(){return v},aU:function(){return x},cS:function(){return g},f0:function(){return h},f_:function(){return m},fm:function(){return f},jO:function(){return y},xJ:function(){return u}});var t=s(8551),n=s(202),r=s(8029),i=s(9726),l=s(8999);let c={employees:["employees"],employeesList:e=>[...c.employees,"list",e],employeesInfinite:e=>[...c.employees,"infinite",e],employee:e=>[...c.employees,"detail",e],managers:["managers"],hierarchy:["hierarchy"],hierarchyTree:["hierarchy","tree"],dashboard:["dashboard"],dashboardStats:["dashboard","stats"],user:["user"],currentUser:["user","current"]},o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;return(0,i.N)({queryKey:c.employeesInfinite(e),queryFn:async a=>{var s;let{pageParam:t=1}=a;return(await l.Z.get("/employees",{params:{...e,page:t,limit:null!==(s=e.limit)&&void 0!==s?s:50}})).data},initialPageParam:1,getNextPageParam:e=>{var a;if(null==e?void 0:null===(a=e.pagination)||void 0===a?void 0:a.hasNextPage)return(e.pagination.currentPage||1)+1},staleTime:3e5,gcTime:6e5,refetchOnWindowFocus:!1,...a||{}})},d=e=>(0,t.a)({queryKey:c.managers,queryFn:async()=>(await l.Z.get("/employees",{params:{managerOnly:!0,limit:100}})).data,staleTime:6e5,gcTime:9e5,...e}),m=e=>(0,t.a)({queryKey:c.dashboardStats,queryFn:async()=>(await l.Z.get("/employees/stats/dashboard")).data,staleTime:12e4,gcTime:3e5,refetchOnWindowFocus:!0,...e}),u=e=>(0,t.a)({queryKey:c.currentUser,queryFn:async()=>{var e;let a=await l.Z.get("/auth/me");return a.data&&(null!==(e=a.data.user)&&void 0!==e?e:a.data)},staleTime:0,gcTime:3e5,retry:1,refetchOnMount:!0,onSuccess:e=>{if(e)try{localStorage.setItem("user",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("userProfileUpdated",{detail:e}))}catch(e){}},...e||{}}),x=()=>{let e=(0,n.NL)();return()=>{e.clear(),localStorage.removeItem("auth_token"),localStorage.removeItem("user"),window.location.href="/auth/login"}},h=()=>{let e=(0,n.NL)();return(0,r.D)({mutationFn:async e=>(await l.Z.post("/auth/login",e)).data,onSuccess:a=>{e.clear(),localStorage.setItem("auth_token",a.token),localStorage.setItem("user",JSON.stringify(a.user)),e.setQueryData(c.currentUser,a.user)}})},f=()=>{let e=(0,n.NL)();return(0,r.D)({mutationFn:async e=>(await l.Z.post("/employees",{...e,birthDate:new Date(e.birthDate).toISOString()})).data,onSuccess:()=>{e.invalidateQueries({queryKey:c.employees}),e.invalidateQueries({queryKey:c.dashboardStats}),e.invalidateQueries({queryKey:c.hierarchyTree})}})},p=()=>{let e=(0,n.NL)();return(0,r.D)({mutationFn:async e=>{let{id:a,...s}=e;return(await l.Z.put("/employees/".concat(a),{...s,birthDate:new Date(s.birthDate).toISOString()})).data},onSuccess:()=>{e.invalidateQueries({queryKey:c.employees}),e.invalidateQueries({queryKey:c.dashboardStats}),e.invalidateQueries({queryKey:c.hierarchyTree})}})},y=()=>{let e=(0,n.NL)();return(0,r.D)({mutationFn:async e=>(await l.Z.delete("/employees/".concat(e)),e),onSuccess:()=>{e.invalidateQueries({queryKey:c.employees}),e.invalidateQueries({queryKey:c.dashboardStats}),e.invalidateQueries({queryKey:c.hierarchyTree})}})},v=()=>{let e=(0,n.NL)();return a=>{e.prefetchQuery({queryKey:c.employee(a),queryFn:async()=>(await l.Z.get("/employees/".concat(a))).data,staleTime:3e5})}},g=()=>{let e=(0,n.NL)();return function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.prefetchQuery({queryKey:c.employeesList(a),queryFn:async()=>(await l.Z.get("/employees",{params:a})).data,staleTime:3e5})}}},8999:function(e,a,s){"use strict";let t=s(7066).Z.create({baseURL:"http://localhost:5000/api",timeout:1e4});t.interceptors.request.use(e=>{{let a=localStorage.getItem("auth_token");a&&(e.headers.Authorization="Bearer ".concat(a))}return e},e=>Promise.reject(e)),t.interceptors.response.use(e=>e,e=>{var a;return(null===(a=e.response)||void 0===a?void 0:a.status)===401&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user"),window.location.href="/auth/login"),Promise.reject(e)}),a.Z=t},9844:function(e,a,s){"use strict";s.d(a,{_r:function(){return i},bB:function(){return r},p6:function(){return c},xG:function(){return l}});var t=s(1354),n=s.n(t);let r=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40;if(!e||"string"!=typeof e){let e=n().MD5("default@example.com").toString();return"https://www.gravatar.com/avatar/".concat(e,"?s=").concat(a,"&d=identicon")}let s=n().MD5(e.toLowerCase().trim()).toString();return"https://www.gravatar.com/avatar/".concat(s,"?s=").concat(a,"&d=identicon")},i=function(e,a){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:40;if((null==e?void 0:e.profilePicture)&&""!==e.profilePicture.trim()){let a="http://localhost:5000",s=e.profilePicture;return s.startsWith("/api/")?"".concat(a).concat(s):"".concat(a,"/api").concat(s)}return r(a,s)},l=e=>new Intl.NumberFormat("en-ZA",{style:"currency",currency:"ZAR"}).format(e),c=e=>new Date(e).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})},2121:function(e,a,s){"use strict";function t(e){switch(e){case"ADMIN":return{canViewEmployees:!0,canCreateEmployees:!0,canEditEmployees:!0,canDeleteEmployees:!0,canViewManagers:!0,canAssignManagers:!0,canViewSalaries:!0,canExportData:!0,canManageRoles:!0,canViewReports:!0};case"MANAGER":return{canViewEmployees:!0,canCreateEmployees:!0,canEditEmployees:!0,canDeleteEmployees:!1,canViewManagers:!0,canAssignManagers:!1,canViewSalaries:!0,canExportData:!0,canManageRoles:!1,canViewReports:!0};case"EMPLOYEE":return{canViewEmployees:!0,canCreateEmployees:!1,canEditEmployees:!1,canDeleteEmployees:!1,canViewManagers:!0,canAssignManagers:!1,canViewSalaries:!1,canExportData:!1,canManageRoles:!1,canViewReports:!1};default:return{canViewEmployees:!1,canCreateEmployees:!1,canEditEmployees:!1,canDeleteEmployees:!1,canViewManagers:!1,canAssignManagers:!1,canViewSalaries:!1,canExportData:!1,canManageRoles:!1,canViewReports:!1}}}s.d(a,{$:function(){return t}})},2480:function(){}}]);