(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{6896:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return r(6172)}])},6172:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return P}});var a=r(5893),t=r(7294),l=r(9008),i=r.n(l),o=r(1163),n=r(7536),d=r(7533),c=r(6310),m=r(6501),u=r(3950);let p=t.forwardRef(function(e,s){let{title:r,titleId:a,...l}=e;return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},l),r?t.createElement("title",{id:a},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"}))});var x=r(2637),f=r(202),h=r(8029);let v=t.forwardRef(function(e,s){let{title:r,titleId:a,...l}=e;return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},l),r?t.createElement("title",{id:a},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))});var y=r(3903),g=r(8999),b=r(9844);function N(e){var s;let{user:r,onUpdate:l}=e,[i,o]=(0,t.useState)(!1),[n,d]=(0,t.useState)(null),[c,u]=(0,t.useState)(r),p=(0,t.useRef)(null),x=(0,f.NL)();(0,t.useEffect)(()=>{let e=e=>{u(e.detail)};return window.addEventListener("userProfileUpdated",e),()=>{window.removeEventListener("userProfileUpdated",e)}},[]),(0,t.useEffect)(()=>{u(r)},[r]);let N=(0,b._r)(c.employee,c.email,200),j=(0,h.D)({mutationFn:async e=>{let s=new FormData;return s.append("profilePicture",e),(await g.Z.post("/upload/profile-picture",s,{headers:{"Content-Type":"multipart/form-data"}})).data},onSuccess:e=>{m.ZP.success("Profile picture updated successfully!"),d(null),p.current&&(p.current.value=""),console.log("\uD83D\uDCE4 Upload response data:",e);let s=JSON.parse(localStorage.getItem("user")||"{}");s.employee&&(console.log("\uD83D\uDC64 Before update - employee data:",s.employee),s.employee.profilePicture=e.profilePicture,console.log("\uD83D\uDC64 After update - employee data:",s.employee),localStorage.setItem("user",JSON.stringify(s)),window.dispatchEvent(new CustomEvent("userProfileUpdated",{detail:s}))),x.invalidateQueries({queryKey:["user"]})},onError:e=>{var s,r;m.ZP.error((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Failed to upload profile picture"),d(null),p.current&&(p.current.value="")},onSettled:()=>{o(!1)}}),w=(0,h.D)({mutationFn:async()=>(await g.Z.delete("/upload/profile-picture")).data,onSuccess:()=>{m.ZP.success("Profile picture removed successfully!");let e=JSON.parse(localStorage.getItem("user")||"{}");e.employee&&(e.employee.profilePicture=null,localStorage.setItem("user",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("userProfileUpdated",{detail:e}))),x.invalidateQueries({queryKey:["user"]})},onError:e=>{var s,r;m.ZP.error((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Failed to remove profile picture")}});return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:n||N,alt:"Profile",className:"h-24 w-24 rounded-full object-cover border-4 border-white shadow-lg",onError:e=>{let s=e.target,a=(0,b.bB)(r.email,200);s.src!==a&&(s.src=a)}}),i&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("button",{onClick:()=>{var e;null===(e=p.current)||void 0===e||e.click()},disabled:i,className:"btn-primary inline-flex items-center space-x-2 disabled:opacity-50",children:[(0,a.jsx)(v,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:i?"Uploading...":"Upload Photo"})]}),(null===(s=c.employee)||void 0===s?void 0:s.profilePicture)&&(0,a.jsxs)("button",{onClick:()=>{window.confirm("Are you sure you want to remove your profile picture?")&&w.mutate()},disabled:w.isPending,className:"btn-outline inline-flex items-center space-x-2 text-red-600 border-red-300 hover:bg-red-50 disabled:opacity-50",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Remove"})]})]}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:[(0,a.jsx)("p",{children:"Upload a custom profile picture or keep using your Gravatar."}),(0,a.jsx)("p",{children:"Accepted formats: JPEG, PNG, GIF, WebP (max 5MB)"})]})]})]}),(0,a.jsx)("input",{ref:p,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",onChange:e=>{var s;let r=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!r)return;if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(r.type)){m.ZP.error("Please select a valid image file (JPEG, PNG, GIF, or WebP)");return}if(r.size>5242880){m.ZP.error("File size must be less than 5MB");return}let a=new FileReader;a.onload=e=>{var s;d(null===(s=e.target)||void 0===s?void 0:s.result)},a.readAsDataURL(r),o(!0),j.mutate(r)},className:"hidden",disabled:i})]})}let j=c.Ry({firstName:c.Z_().required("First name is required"),lastName:c.Z_().required("Last name is required"),email:c.Z_().email("Invalid email").required("Email is required"),position:c.Z_().required("Position is required"),birthDate:c.Z_().required("Birth date is required")}),w=c.Ry({currentPassword:c.Z_().required("Current password is required"),newPassword:c.Z_().min(8,"Password must be at least 8 characters").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Password must contain at least one uppercase letter, one lowercase letter, and one number").required("New password is required"),confirmPassword:c.Z_().oneOf([c.iH("newPassword")],"Passwords must match").required("Please confirm your new password")});function P(){var e,s,r,l,c,f,h,v,y;let[b,P]=(0,t.useState)("profile"),[E,S]=(0,t.useState)(!1),[D,Z]=(0,t.useState)(!1),I=(0,o.useRouter)(),[k,C]=(0,t.useState)(null),[_,q]=(0,t.useState)(!0);(0,t.useEffect)(()=>{let e=localStorage.getItem("auth_token"),s=localStorage.getItem("user");if(!e||!s){I.push("/auth/login");return}try{let e=JSON.parse(s);C(e)}catch(e){console.error("Error parsing user data:",e),I.push("/auth/login")}finally{q(!1)}},[I]);let O=(null==k?void 0:k.role)==="ADMIN",{register:U,handleSubmit:L,formState:{errors:A},reset:F}=(0,n.cI)({resolver:(0,d.X)(j)}),{register:M,handleSubmit:J,formState:{errors:R},reset:B}=(0,n.cI)({resolver:(0,d.X)(w)});(0,t.useEffect)(()=>{if(!localStorage.getItem("auth_token")){I.push("/auth/login");return}},[I]),(0,t.useEffect)(()=>{(null==k?void 0:k.employee)&&"ADMIN"===k.role&&F({firstName:k.employee.firstName||"",lastName:k.employee.lastName||"",email:k.email||"",position:k.employee.position||"",birthDate:k.employee.birthDate?new Date(k.employee.birthDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0]})},[k,F]);let G=async e=>{if(!(null==k?void 0:k.employee)||!O){m.ZP.error("You do not have permission to edit profiles");return}S(!0);try{let s={firstName:e.firstName,lastName:e.lastName,email:e.email,position:e.position,birthDate:new Date(e.birthDate).toISOString()},r=await g.Z.put("/employees/".concat(k.employee.id),s),a={...k,email:s.email,employee:{...k.employee,...r.data.employee}};localStorage.setItem("user",JSON.stringify(a)),C(a),window.dispatchEvent(new CustomEvent("userProfileUpdated",{detail:a})),m.ZP.success("Profile updated successfully!")}catch(e){var s,r;console.error("Profile update error:",e),m.ZP.error((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Failed to update profile")}finally{S(!1)}},T=async e=>{Z(!0);try{await g.Z.post("/auth/change-password",{currentPassword:e.currentPassword,newPassword:e.newPassword}),m.ZP.success("Password changed successfully!"),B()}catch(e){var s,r;console.error("Password change error:",e),m.ZP.error((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Failed to change password")}finally{Z(!1)}},W=async()=>{try{var e,s;if(!localStorage.getItem("auth_token")||!(null==k?void 0:null===(e=k.employee)||void 0===e?void 0:e.id))return;let r=localStorage.getItem("user"),a=r?JSON.parse(r):k,t=(await g.Z.get("/employees/".concat(k.employee.id))).data.employee,l={...k,employee:{...k.employee,...t,profilePicture:(null===(s=a.employee)||void 0===s?void 0:s.profilePicture)||t.profilePicture}};localStorage.setItem("user",JSON.stringify(l)),C(l),window.dispatchEvent(new CustomEvent("userProfileUpdated",{detail:l}))}catch(s){console.error("Error refreshing user data:",s);let e=localStorage.getItem("user");if(e){let s=JSON.parse(e);C(s),window.dispatchEvent(new CustomEvent("userProfileUpdated",{detail:s}))}}};if(_)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-company-navy"})});if(!k)return null;let z=[{id:"profile",name:"Profile",icon:u.Z},{id:"security",name:"Security",icon:p}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"Profile - EPI-USE Nexus"}),(0,a.jsx)("meta",{name:"description",content:"Manage your profile and account settings"})]}),(0,a.jsx)(x.Z,{user:k,children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"card",children:(0,a.jsx)("div",{className:"card-body",children:(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:(null===(e=k.employee)||void 0===e?void 0:e.firstName)&&(null===(s=k.employee)||void 0===s?void 0:s.lastName)?"".concat(k.employee.firstName," ").concat(k.employee.lastName):k.email}),(0,a.jsx)("p",{className:"text-gray-600",children:null===(r=k.employee)||void 0===r?void 0:r.position}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Employee ID: ",null===(l=k.employee)||void 0===l?void 0:l.employeeNumber]})]})})})}),(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("nav",{className:"-mb-px flex space-x-8",children:z.map(e=>(0,a.jsxs)("button",{onClick:()=>P(e.id),className:"group inline-flex items-center py-2 px-1 border-b-2 font-medium text-sm ".concat(b===e.id?"border-company-navy text-company-navy":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,a.jsx)(e.icon,{className:"mr-2 h-5 w-5"}),e.name]},e.id))})}),"profile"===b&&(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Profile Picture"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Update your profile picture"})]}),(0,a.jsx)("div",{className:"card-body",children:(0,a.jsx)(N,{user:k,onUpdate:W})})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Profile Information"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:O?"Update profile information as system administrator":"View your personal information"})]}),(0,a.jsx)("div",{className:"card-body",children:O?(0,a.jsxs)("form",{onSubmit:L(G),className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"First Name"}),(0,a.jsx)("input",{...U("firstName"),type:"text",className:"input-field ".concat(A.firstName?"border-red-300":"")}),A.firstName&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:A.firstName.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Last Name"}),(0,a.jsx)("input",{...U("lastName"),type:"text",className:"input-field ".concat(A.lastName?"border-red-300":"")}),A.lastName&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:A.lastName.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Email"}),(0,a.jsx)("input",{...U("email"),type:"email",className:"input-field ".concat(A.email?"border-red-300":"")}),A.email&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:A.email.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Position"}),(0,a.jsx)("input",{...U("position"),type:"text",className:"input-field ".concat(A.position?"border-red-300":"")}),A.position&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:A.position.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Birth Date"}),(0,a.jsx)("input",{...U("birthDate"),type:"date",className:"input-field ".concat(A.birthDate?"border-red-300":"")}),A.birthDate&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:A.birthDate.message})]}),(0,a.jsx)("button",{type:"submit",disabled:E,className:"btn-primary w-full disabled:opacity-50",children:E?"Updating...":"Update Profile"}),(0,a.jsx)("div",{className:"bg-purple-50 border-purple-200 border rounded-md p-3",children:(0,a.jsxs)("p",{className:"text-sm text-purple-800",children:[(0,a.jsx)("strong",{children:"System Administrator Access:"})," You have full access to update all profile information."]})})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"First Name"}),(0,a.jsx)("input",{type:"text",value:(null==k?void 0:null===(c=k.employee)||void 0===c?void 0:c.firstName)||"",disabled:!0,className:"input-field bg-gray-50 cursor-not-allowed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Last Name"}),(0,a.jsx)("input",{type:"text",value:(null==k?void 0:null===(f=k.employee)||void 0===f?void 0:f.lastName)||"",disabled:!0,className:"input-field bg-gray-50 cursor-not-allowed"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Email"}),(0,a.jsx)("input",{type:"email",value:(null==k?void 0:k.email)||"",disabled:!0,className:"input-field bg-gray-50 cursor-not-allowed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Position"}),(0,a.jsx)("input",{type:"text",value:(null==k?void 0:null===(h=k.employee)||void 0===h?void 0:h.position)||"",disabled:!0,className:"input-field bg-gray-50 cursor-not-allowed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Employee Number"}),(0,a.jsx)("input",{type:"text",value:(null==k?void 0:null===(v=k.employee)||void 0===v?void 0:v.employeeNumber)||"",disabled:!0,className:"input-field bg-gray-50 cursor-not-allowed"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Birth Date"}),(0,a.jsx)("input",{type:"date",value:(null==k?void 0:null===(y=k.employee)||void 0===y?void 0:y.birthDate)?new Date(k.employee.birthDate).toISOString().split("T")[0]:"",disabled:!0,className:"input-field bg-gray-50 cursor-not-allowed"})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Profile Information:"})," This information is managed by your system administrator.",(null==k?void 0:k.role)==="EMPLOYEE"&&" Employees request edits from Managers, and Managers request edits from Admins.",(null==k?void 0:k.role)==="MANAGER"&&" As a Manager, you can request edits from system Administrators."," ","Please contact your system administrator or submit a request through your organization's IT portal."]})})]})})]})]}),"security"===b&&(0,a.jsxs)("div",{className:"card max-w-md",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Change Password"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Update your account password"})]}),(0,a.jsx)("div",{className:"card-body",children:(0,a.jsxs)("form",{onSubmit:J(T),className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Current Password"}),(0,a.jsx)("input",{...M("currentPassword"),type:"password",className:"input-field ".concat(R.currentPassword?"border-red-300":"")}),R.currentPassword&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:R.currentPassword.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"New Password"}),(0,a.jsx)("input",{...M("newPassword"),type:"password",className:"input-field ".concat(R.newPassword?"border-red-300":"")}),R.newPassword&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:R.newPassword.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Confirm New Password"}),(0,a.jsx)("input",{...M("confirmPassword"),type:"password",className:"input-field ".concat(R.confirmPassword?"border-red-300":"")}),R.confirmPassword&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:R.confirmPassword.message})]}),(0,a.jsx)("button",{type:"submit",disabled:D,className:"btn-primary w-full disabled:opacity-50",children:D?"Changing...":"Change Password"})]})})]})]})})]})}},3903:function(e,s,r){"use strict";var a=r(7294);let t=a.forwardRef(function(e,s){let{title:r,titleId:t,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},l),r?a.createElement("title",{id:t},r):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))});s.Z=t}},function(e){e.O(0,[66,814,134,666,216,393,888,774,179],function(){return e(e.s=6896)}),_N_E=e.O()}]);